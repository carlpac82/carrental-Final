<!DOCTYPE html>
<html>
<head>
    <title>Vehicle Editor</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-[#009cb6]">Vehicle Editor</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <span class="text-lg font-semibold">Total: <span id="totalVehicles">0</span> vehicles</span>
                </div>
                <button onclick="loadVehicles()" class="px-4 py-2 bg-[#009cb6] text-white rounded hover:bg-[#007a8e]">
                    ðŸ”„ Reload
                </button>
            </div>
            
            <input type="text" id="searchInput" placeholder="Search..." 
                   class="w-full px-4 py-2 border rounded mb-4"
                   onkeyup="filterVehicles()">
        </div>
        
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <table class="min-w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Brand</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Model</th>
                    </tr>
                </thead>
                <tbody id="vehiclesTable">
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                            Loading...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        let allVehicles = [];
        
        async function loadVehicles() {
            console.log('[LOAD] Starting...');
            
            try {
                const response = await fetch('/api/vehicles/with-originals');
                console.log('[LOAD] Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('[LOAD] Data:', data);
                
                if (!data.ok) {
                    throw new Error(data.error || 'Unknown error');
                }
                
                if (!data.vehicles) {
                    throw new Error('No vehicles in response');
                }
                
                // Convert to array
                allVehicles = Object.entries(data.vehicles).map(([clean, info]) => ({
                    clean: clean,
                    original: info.original || clean,
                    category: info.category || 'Unknown',
                    brand: clean.split(' ')[0] || '',
                    model: clean.split(' ').slice(1).join(' ') || ''
                }));
                
                console.log('[LOAD] Processed:', allVehicles.length, 'vehicles');
                
                document.getElementById('totalVehicles').textContent = allVehicles.length;
                renderVehicles(allVehicles);
                
            } catch (error) {
                console.error('[LOAD] Error:', error);
                document.getElementById('vehiclesTable').innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-red-500">
                            Error: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }
        
        function renderVehicles(vehicles) {
            const tbody = document.getElementById('vehiclesTable');
            
            if (vehicles.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                            No vehicles found
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = vehicles.map(v => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${v.clean}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${v.category}</td>
                    <td class="px-6 py-4 text-sm text-gray-500 capitalize">${v.brand}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${v.model}</td>
                </tr>
            `).join('');
        }
        
        function filterVehicles() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = allVehicles.filter(v => 
                v.clean.includes(search) ||
                v.category.toLowerCase().includes(search) ||
                v.brand.includes(search) ||
                v.model.includes(search)
            );
            
            renderVehicles(filtered);
        }
        
        // Load on page load
        window.addEventListener('DOMContentLoaded', loadVehicles);
    </script>
</body>
</html>
